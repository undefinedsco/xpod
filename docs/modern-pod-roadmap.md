# 现代化 Pod 控制面的功能边界与路线图

本文整理我们在讨论中达成的共识：现代化 Pod 应在自身控制面内承担哪些能力、哪些职责应交给外部 Solid App，并给出阶段性路线图与当前社区版实现现状，便于团队统一方向。

---

## 功能分层与边界

- **控制面（Control Plane）**：登录后由 Pod 官方界面提供，负责账号、授权策略、系统配置与安全审计的集中入口。这里的操作者身份来自凭据（Email/Password、Token 等），但任何资源访问最终仍通过其绑定的 WebID 写入 ACL/ACP。
- **基础数据面（First-Party Data Plane）**：Pod 直接托管的文件、RDF 资源与配额指标。控制面需内置对这些数据的全局查看、检索、版本回滚与导入导出，确保数据主权与审计闭环。
- **业务化数据面（Third-Party Apps）**：依赖授权协议访问 Pod 数据的领域应用。它们聚焦业务逻辑，可调用 Pod API，但不得绕开或直接修改授权策略，敏感操作需回到控制面确认。
- **信任与审计边界**：所有敏感操作（分享、回滚、配额调整、凭证管理）必须在控制面执行，以维持单一可信源和完整日志；外部 App 可触发流程，但最终写入由 Pod 核心服务完成。

---

## 控制面应内建的基线能力

| 能力域 | Pod 原生职责 | 外部 App 协同方式 |
| --- | --- | --- |
| 身份与安全 | 多因素认证、凭证生命周期、授权审计、策略回滚；暴露 `WAC-Allow`/ACP 结果以供调试 | 通过 OIDC/OAuth 获取授权；若需自助 Token，则由控制面签发 |
| 数据全景 | 资源树浏览、搜索、版本历史、快照导出/导入、跨集群搬迁 | 使用 Pod 提供的 API 读写数据；可挂载摘要或链接到自身视图 |
| 权限治理 | ACL/ACP 可视化编辑、批量授权、分享链接、WebID 绑定/解除 | 发起授权申请后跳回控制面确认；读取授权状态以调整 UX |
| 配额与计量 | 配额上限配置、实时用量、阈值告警、计费 Webhook | 使用标准事件/接口同步元数据，不直接写配额 |
| 通知与观测 | 操作日志、访问日志、异常告警、Webhook/Stream 出口 | 订阅通知并在业务流程中消费 |
| 运维工具 | 节点注册、健康度面板、滚动升级、备份恢复、配置管理 | 外部自动化系统可调用 API，但需凭控制面颁发的凭证 |
| 开发者接口 | Token 管理、API 文档、Webhooks、CLI 下载 | 业务 App 按需申请权限并遵守最小授权 |

---

## 路线图（Roadmap）

1. **Phase 0 — 控制面基线上线**
   - 集成认证链路，保证登录后能访问官方控制台。
   - 提供账号、Pod、节点等核心资源的只读总览。
   - 为后续模块准备配置接口（如 `/config` 返回特性开关）。

2. **Phase 1 — 授权与安全强化**
   - 在控制面补齐凭证管理（Password、Client Credential、Token）与外部 WebID 绑定的 UI/流程。
   - 增强 ACL/ACP 管理体验，支持分享链接、批量授权和撤销。
   - 引入审计日志面板与基础告警配置。

3. **Phase 2 — 数据治理与配额**
   - 实现内置文件/数据浏览器、版本历史、导入导出。
   - 打通 UsageTrackingStore 指标，展现实时/历史配额用量并开放限额调整。
   - 提供批量操作（如离线备份、全量导出）与自动化入口（Webhooks/CLI）。

4. **Phase 3 — 运维与生态扩展**
   - 完善边缘节点/集群运维工具（注册、健康度、滚动升级）。
   - 暴露日志流/事件流接入主流 SIEM，支持自定义告警规则。
   - 引入应用目录与权限审查流程，打通第三方 App 的集成体验。

5. **Phase 4 — 体验与智能化**
   - 提供跨资源搜索、智能推荐（如权限冲突提醒、容量规划）。
   - 支持多租户品牌化、自动化 Onboarding 向导。
   - 对外开放 GraphQL/SDK，形成生态闭环。

---

## 当前社区版实现快照（截至此仓库最新提交）

- **控制台入口**：`AdminConsoleHttpHandler` 将 `/admin` 路径接管，静态资源来自 `dist/ui/admin`（参见 `docs/admin-console-architecture.md`）。
- **配置接口**：`/admin/config` 返回部署模式与特性开关；UI 通过 `AdminConfigContext` 加载。
- **账号/Pod 列表**：`AdminConsoleRepository.fetchOverview` 汇总账户与 Pod 元数据，前端 `AccountsPage`、`PodsPage` 仅提供只读表格。
- **节点管理**：`NodesPage` 支持列出并创建边缘节点，后端 `EdgeNodeRepository` 实现 `GET/POST /admin/nodes`。
- **配额信息**：后端聚合账户与 Pod 用量，但前端仅显示静态说明，尚无限额编辑或历史曲线。
- **安全/日志/Tokens**：`SecurityPage`、`LogsPage` 仍是占位卡片，无凭证 CRUD、日志流或告警设置。
- **数据管理**：尚未提供文件/版本/分享 UI，仍需依赖其他 Solid App 或底层接口。
- **审计与通知**：不存在统一的日志面板或告警配置。

整体来看，当前实现覆盖了路线图的 **Phase 0 部分能力**（登录后控制台、核心资源只读总览、节点注册 API），其余阶段均待建设。

---

## 建议的下一步验证

- 为 Phase 1 设计凭证管理与授权编辑的 API/UI 原型，并确认与 ACL/ACP 存储模型的一致性。
- 梳理数据浏览/版本管理所需的后端接口，对接现有存储访问器（Quadstore、MinIO）。
- 定义审计日志事件模型，确保未来可被 SIEM/告警系统消费。

以上为目前的共识与实施状态，后续如有调整请同步更新此文档。
